
steps:

  - name: app
    image: "django-app-name"
    build:
      context: .
      tags: ["${UNIQUE_ID}", "${GIT.SHA}", "dev"]

  - name: database-export
    image: "django-app-name"
    compose:
      project: "${UNIQUE_ID}"
      run: "app /target/export-db.sh /target/export.sql"
      config:
        app:
          image: "django-app-name:${UNIQUE_ID}"
          links:
            - database
          volumes:
            - ./dockerfiles/database:/target
        database:
          image: "postgres:9.4"

  - name: database
    image: "app-name-database"
    build:
      context: dockerfiles/database
      tags: ["${UNIQUE_ID}", "${GIT.SHA}", "dev"]
